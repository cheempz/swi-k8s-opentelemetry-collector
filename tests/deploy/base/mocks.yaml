---
apiVersion: v1
kind: ConfigMap
metadata:
  name: swi-opentelemetry-collector-endpoint-mock
  labels:
    app.kubernetes.io/name: swi-opentelemetry-collector-endpoint-mock
    app.kubernetes.io/instance: swi-opentelemetry-collector-endpoint-mock
data:
  relay: |
    exporters:
      logging:
        loglevel: debug
    extensions:
      health_check: {}
      memory_ballast:
        size_mib: "204"
    processors:
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:9082
    service:
      extensions:
      - health_check
      - memory_ballast
      pipelines:
        metrics:
          exporters:
          - logging
          processors:
          receivers:
          - otlp
        logs:
          exporters:
          - logging
          processors:
          receivers:
          - otlp
---
apiVersion: v1
kind: Service
metadata:
  name: timeseries-mock-service
spec:
  selector:
    app: timeseries-mock-service
  ports:
    - protocol: TCP
      port: 9082
      targetPort: 9082
      name: grpc
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: timeseries-mock-service
spec:
  replicas: 1
  selector:
    matchLabels:
      app: timeseries-mock-service
  template:
    metadata:
      labels:
        app: timeseries-mock-service
    spec:
      securityContext:
        {}
      containers:
        - name: opentelemetry-collector
          command:
            - /otelcol-contrib
            - --config=/conf/relay.yaml
          securityContext:
            {}
          image: "otel/opentelemetry-collector-contrib:0.43.0"
          imagePullPolicy: IfNotPresent
          ports:
            - name: otlp
              containerPort: 9082
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /
              port: 13133
          readinessProbe:
            httpGet:
              path: /
              port: 13133
          resources:
            limits:
              cpu: 256m
              memory: 512Mi
          volumeMounts:
            - mountPath: /conf
              name: opentelemetry-collector-configmap
      volumes:
        - name: opentelemetry-collector-configmap
          configMap:
            name: swi-opentelemetry-collector-endpoint-mock
            items:
              - key: relay
                path: relay.yaml



